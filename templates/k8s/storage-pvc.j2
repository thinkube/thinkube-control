# Generated PersistentVolumeClaims for containers with volume mounts or GPU resources
{% for container in thinkube_spec.spec.containers %}
{% if container.volume is defined %}
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: {{ project_name }}-{{ container.name }}-storage
  namespace: {{ k8s_namespace }}
  labels:
    app.kubernetes.io/name: {{ project_name }}
    app.kubernetes.io/component: {{ container.name }}
    app.kubernetes.io/managed-by: argocd
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 1Gi
  storageClassName: k8s-hostpath
{% elif container.gpu is defined and container.gpu.count is defined %}
# Auto-generated PVC for GPU containers (JuiceFS MLflow access)
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: {{ project_name }}-{{ container.name }}-mlflow-models
  namespace: {{ k8s_namespace }}
  labels:
    app.kubernetes.io/name: {{ project_name }}
    app.kubernetes.io/component: {{ container.name }}
    app.kubernetes.io/managed-by: argocd
    app.kubernetes.io/purpose: mlflow-model-storage
spec:
  accessModes:
    - ReadWriteMany
  resources:
    requests:
      # Minimal size - JuiceFS provides POSIX access to MLflow S3 bucket
      storage: 1Gi
  storageClassName: juicefs-mlflow
{% endif %}
{% endfor %}